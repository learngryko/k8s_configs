apiVersion: crd.projectcalico.org/v1
kind: GlobalNetworkPolicy
metadata:
  name: global-default-security
spec:
  order: 1000
  selector: all()

  ingress:
    # Allow all ingress traffic within the argocd namespace
    - action: Allow
      source:
        namespaceSelector: 'name == "argocd"'
      destination:
        namespaceSelector: 'name == "argocd"'

    # Allow ingress traffic from the monitoring namespace
    - action: Allow
      source:
        namespaceSelector: 'name == "monitoring"'

    # Deny all other ingress traffic
    - action: Deny
      source: {}

  egress:
    # Allow all egress traffic to the argocd namespace
    - action: Allow
      destination:
        namespaceSelector: 'name == "argocd"'

    # Allow egress DNS (UDP 53) to kube-dns in kube-system
    - action: Allow
      destination:
        namespaceSelector: 'k8s.io/metadata.name == "kube-system"'
        ports: [53]
      protocol: UDP

    # Allow all egress traffic to the monitoring namespace
    - action: Allow
      destination:
        namespaceSelector: 'name == "monitoring"'

    # Allow egress to kube-system namespace (for API, csi, etc.)
    - action: Allow
      destination:
        namespaceSelector: 'k8s.io/metadata.name == "kube-system"'

    # Allow egress to Kubernetes API server (if you know the IP)
    # - action: Allow
    #   destination:
    #     nets: ["<API_SERVER_IP>/32"]
    #   protocol: TCP
    #   ports: [443]

    # Deny all other egress traffic
    - action: Deny
      destination: {}
